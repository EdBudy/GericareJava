<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <title th:text="|Historia Clínica - ${historia.nombrePacienteCompleto}|"></title>
    <th:block th:insert="~{fragments/layout :: head}"></th:block>
</head>
<body class="d-flex flex-column min-vh-100">
<header th:insert="~{fragments/layout :: header}"></header>

<main class="container mt-5 mb-5">
    <h2 th:text="|Historia Clínica de ${historia.nombrePacienteCompleto}|"></h2>
    <div sec:authorize="hasRole('Administrador')" class="mb-3">
        <a th:href="@{|/historias-clinicas/editar/paciente/${historia.idPaciente}|}" class="btn btn-warning">
            <i class="bi bi-pencil-square me-2"></i> Editar Historia Clínica
        </a>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <h5 class="mb-0">Información del Paciente y Contacto</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p class="mb-1"><strong>Documento:</strong> <span th:text="${historia.pacienteDocumento}"></span></p>
                    <p class="mb-1"><strong>Contacto Emergencia (Paciente):</strong> <span th:text="${historia.pacienteContactoEmergencia}"></span></p>
                </div>
                <div class="col-md-6">
                    <p class="mb-1"><strong>Familiar Asociado:</strong> <span th:text="${historia.familiarNombreCompleto}"></span></p>
                    <p class="mb-1"><strong>Teléfono(s) Familiar:</strong>
                        <span th:if="${#lists.isEmpty(historia.familiarTelefonos)}">N/A</span>
                        <th:block th:each="tel, iter : ${historia.familiarTelefonos}">
                            <span th:text="${tel}"></span><span th:if="${!iter.last}">, </span>
                        </th:block>
                    </p>
                </div>
            </div>
        </div>
        <div class="card-body">
            <h5 class="card-title">Datos Generales</h5>
            <p><strong>Estado De Salud:</strong> <span th:text="${historia.estadoSalud}"></span></p>
            <p><strong>Condiciones:</strong> <span th:text="${historia.condiciones}"></span></p>
            <p><strong>Antecedentes Médicos:</strong> <span th:text="${historia.antecedentesMedicos}"></span></p>
            <p><strong>Alergias:</strong> <span th:text="${historia.alergias}"></span></p>
            <p><strong>Dietas Especiales:</strong> <span th:text="${historia.dietasEspeciales}"></span></p>
            <p><strong>Última Consulta:</strong> <span th:text="${historia.fechaUltimaConsulta != null ? #temporals.format(historia.fechaUltimaConsulta, 'dd/MM/yyyy') : 'N/A'}"></span></p>
            <p><strong>Observaciones Generales:</strong> <span th:text="${historia.observaciones}"></span></p>
            <hr>
            <h5>Cirugías</h5>
            <ul th:if="${not #lists.isEmpty(historia.cirugias)}">
                <li th:each="c : ${historia.cirugias}" th:text="|${c.descripcionCirugia} (${#temporals.format(c.fechaCirugia, 'dd/MM/yyyy')}) - Obs: ${c.observaciones}|"></li>
            </ul>
            <p th:if="${#lists.isEmpty(historia.cirugias)}">No hay cirugías registradas.</p>
            <hr>
            <h5>Medicamentos</h5>
            <ul th:if="${not #lists.isEmpty(historia.medicamentos)}">
                <li th:each="m : ${historia.medicamentos}" th:text="|${m.nombreMedicamento} - Dosis: ${m.dosis}, Frecuencia: ${m.frecuencia}, Instrucciones: ${m.instrucciones}|"></li>
            </ul>
            <p th:if="${#lists.isEmpty(historia.medicamentos)}">No hay medicamentos registrados.</p>
            <hr>
            <h5>Enfermedades</h5>
            <ul th:if="${not #lists.isEmpty(historia.enfermedades)}">
                <li th:each="e : ${historia.enfermedades}" th:text="|${e.descripcionEnfermedad} (Diagnosticado: ${#temporals.format(e.fechaDiagnostico, 'dd/MM/yyyy')}) - Obs: ${e.observaciones}|"></li>
            </ul>
            <p th:if="${#lists.isEmpty(historia.enfermedades)}">No hay enfermedades registradas.</p>
        </div>
    </div>
    <div class="mt-3">
        <a th:href="@{/pacientes}" class="btn btn-secondary">Volver a la Lista de Pacientes</a>
    </div>
</main>
<footer th:insert="~{fragments/layout :: footer-content}"></footer>
</body>
</html>